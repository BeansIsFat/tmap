---
title: "tmap layers part 1: visual variables"
author: "Martijn Tennekes"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 2
link-citations: yes
vignette: >
  \usepackage[utf8]{inputenc}
  %\VignetteIndexEntry{tmap layers: visual variables}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 9, warning = FALSE)
```

```{r, echo = FALSE, message = FALSE}
library(tmap)
data(World, metro, rivers, land)
#tmap_design_mode()
```

## Visual variables

A **visual variable** describes a certain visual property of an drawn object, such as color, size, shape, line width, line stroke, transparency, fill pattern. (In ggplot2 these are called aesthetics.). A visual variable can be specified using a constant value (e.g. `fill = "blue"`) or **data-driven** (more on this later). If it can *only* be specified with a constant value, it is called a **visual constant**. 

A (thematic) map consists of one or more **map layers**. Each map layer has a specific set of visual variables that determine how the objects of that layer are drawn. The following table shows which visual variables are used in standard map layers.

| Map layer			| Visual variables | Visual constant |
|-				|---							|--							|
| `tm_basemap`  	| none							| `alpha`						|
| `tm_polygons`     | `fill` (fill color), `col` (border color), `lwd` (border line width) `lty` (border line type), `fill_alpha` fill transparency, `col_alpha` border color transparency		| `linejoin` (line join) and `lineend` (line end) |
| `tm_symbols`		| `fill` (fill color), `col` (border color), `size`, `shape`, `lwd` (border line width) `lty` (border line type), `fill_alpha` fill transparency, `col_alpha` border color transparency		| `linejoin` (line join) and `lineend` (line end) |
| `tm_lines`   		| `col` (color), `lwd` (line width) `lty` (line type), `alpha` transparency	| `linejoin` (line join) and `lineend` (line end) |
| `tm_raster`   	| `col` (color), `alpha` (transparency)	| |
| `tm_text`   		| `size`, `col` | |

New in tmap 4.0 is that users can write their own custom map layer functions; more on this in another vignette. Important for now is that map layers and their visual variables can be extended if needed.   

### Basic examples

This map specifies the fill color of country polygons to be gold:

```{r}
tm_shape(World) +
	tm_polygons("gold")
```

For those who are completely new to tmap: the function `tm_shape` specifies the spatial data object, which can be any spatial data object from the packages `sf`, `stars`, `terra`, `sp`, and `raster`. The subsequent map layer functions (stacked with the `+` operator) specify how this spatial data is visualized. 

```{r}
tm_basemap(server = "OpenTopoMap", zoom = 2, alpha = 0.5) +
tm_shape(World, bbox = sf::st_bbox(c(xmin = -180, xmax = 180, ymin = -86, ymax = 86))) +
	tm_polygons(fill = NA, col = "black") +
tm_shape(metro) +
	tm_symbols(size = 0.1, col = "red") +
tm_layout(inner.margins = rep(0, 4))
```

```{r}
tm_shape(land) +
	tm_raster("trees", col_alpha = 0.5)
```



##

