---
title: "tmap v4: upcoming changes"
author: "Martijn Tennekes"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 2
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Total renovation: why?

The upcoming tmap version 4.0 has been build almost from scratch. Why?

* _Extendibility_: we got a lot of questions via Stack Overflow and GitHub such as: "Is it possible to map a data variable to line type?" and "Is it possible to create a bivariate choropleth?". Many of those feature request where hard to implement because the layer functions and its arguments were hard-coded into the core of tmap. As of v4, the layer function definitions as not part of the core of tmap anymore, which makes improving layer functions and creating new ones easy.

* _Organization and consistency of layer arguments_ Each layer function can have one or more aesthetics. For instance, `col` for `tm_raster` and `col`, `size` and `shape` for `tm_symbols`. As a result, the number of arguments is huge, especially for `tm_symbols` were is became hard to see the trees through the forest. That also means that we were reluctant to add any more arguments. But as of v4, this will be much better. As I will explain below, each aesthetic will only have 4 arguments:

1. a 'main' argument (e.g. `"col"`) that determines which value or data variable to use, 
2. a 'scale' argument (e.g. `"col.scale"`) which determines _how_ the data variables are mapped to (in this case) a color palette,
3. a 'legend' arugment (e.g. `"col.legend"`) which determines what type of legend will be shown and where, and 
4. a 'free' arugment (e.g. `"col.free"`) which determines whether scalel are shared across facets.

* _Even more options_ Duo to the improved organization of the layer arguments, tmap will become even more flexible.







## Layer functions




### More and more aethetics

### Its arguments: scale, and free, legend

### _transformation_ and _mapping_ aesthetics

### Extendable



## Scales




## Graphics

### Legend placement

### Extendable

## Spatial classes

### Native support for sf, stars and terra

### Extendable
