---
title: "Testing - Facetting"
author: "Martijn Tennekes"
date: "`r Sys.Date()`"
output: html_document
---
	
	```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 9)
```

# Instructions

Open the tmap repository as RStudio project.
Set Knit Directory (via drop-down menu of the Knit button in RStudio) to Project Directory.

```{r echo=FALSE,message=FALSE,fig.height = 2}
library(devtools)
load_all()
data(World,metro,land)

World$pop_class = cut(World$pop_est, breaks = c(0, 10, 100, 1000, Inf) * 1e6, labels = c("Small", "Medium", "Large", "Extra Large"))					   
World$HPI_class = cut(World$HPI, breaks = seq(10, 50, by = 10))
World$well_being_class = cut(World$well_being, breaks = seq(2, 8, by = 2))
World$footprint_class = cut(World$footprint, breaks = seq(0, 16, by = 4))

metro$pop2020_class = cut(metro$pop2020, breaks = c(.5, 1.5, 2.5, 5, 15, 40) * 1e6)



Africa = World[World$continent == "Africa", ]
tmapV = substr(packageVersion("tmap"), 1, 1)
txt = function(x) print(grid::grid.text(x, gp = gpar(cex = 3)))
v3 = function(e) {
	if (tmapV == "3") {
		print(e)
	} else {
		txt("Only for tmap 3")
	}
	invisible(NULL)
}
v4 = function(e) {
	if (tmapV == "4") {
		print(e)
	} else {
		txt("Only for tmap 4")
	}
	invisible(NULL)
}
txt(paste("Loaded tmap version", tmapV))
```

# Facetting shapes

These tests focus on dealing with shapes when facets are created.
Legends, scales will be studied in other tests.

## Polygons

### One facet

```{r}
tm_shape(World) +
	tm_polygons("HPI")
```

```{r}
tmap_options(legend.is.portrait = FALSE)
tm_shape(World) +
	tm_polygons("HPI")
```


```{r}
tmap_options(legend.design = "portrait", legend.frame=TRUE)
tmap_design_mode()

tmap_options(legend.frame=TRUE,
			 legend.height = Inf,
			legend.settings = list(portrait = list(item.height = c(rect = -1, symbols = 1, gradient = 1.8),
											   item.width = c(rect = 1, symbols = 1, gradient = 1),
											   margin.item.text = 0.5,
											   item.padding = c(rect = 0.2, symbols = 0.3, gradient = 0),
											   item.na.padding = c(rect = 0.4, symbols = 0.3, gradient = 0.3),
											   title.padding  = c(0.125, 0, 0.25, 0),
											   margins = c(0.4, 0.4, 0.75, 0.4)),
							   landscape = list(item.height = c(rect = 1, symbols = 1, gradient = 1.8),
							   				 item.width = c(rect = 1, symbols = 1, gradient = 1),
							   				 margin.item.text = 0.25,
							   				 item.padding = c(rect = 0.2, symbols = 0.3, gradient = 0),
							   				 item.na.padding = c(rect = 0.2, symbols = 0.3, gradient = 0.3),
							   				 title.padding  = c(0.125, 0, 0.25, 0),
							   				 margins = c(0.4, 0.4, 0.4, 0.4))))
tm_shape(World) +
	tm_polygons("HPI", col = "economy")

tm_shape(land) +
	tm_raster("cover")

tm_shape(World) +
	tm_symbols(fill = "economy", size = "pop_est", shape = 16, size.scale = tm_scale_continuous(values.scale = 3))
tm_shape(World) +
	tm_symbols(fill = "economy", size = "pop_est", shape = 23, size.scale = tm_scale_continuous(values.scale = 3))


tm_shape(World) +
	tm_polygons("HPI", col = "economy", fill.scale = tm_scale_continuous())

```


```{r}
tmap_options(legend.is.portrait = FALSE)
tmap_options(legend.landscape.setup = list(item.width = 1, space = 3, margin = 1))
tm_shape(World) +
	tm_polygons("HPI")
tmap_options(legend.landscape.setup = list(item.width = 3, space = 1, margin = 1))
tm_shape(World) +
	tm_polygons("HPI")
tmap_options(legend.landscape.setup = list(item.width = -1, space = 0, margin = 1))
tm_shape(World) +
	tm_polygons("HPI")
tmap_options(legend.landscape.setup = list(item.width = -1, space = 0, margin = 0))
tm_shape(World) +
	tm_polygons("HPI")
tmap_options(legend.landscape.setup = list(item.width = -1, space = 1, margin = 0))
tm_shape(World) +
	tm_polygons("HPI")
tm_shape(World, filter = World$pop_est > 100e6) +
	tm_polygons(c("HPI", "economy"))

```




### Multiple facets, specified with multiple variables

```{r}
# one polygon shape, two aes values
tm_shape(World) +
	tm_polygons(c("HPI", "income_grp"))
```

